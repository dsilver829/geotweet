function newItem() {
  var currentId = $('.list-group-item').first().attr('id');
  var newId = "<%= @geotweets.results.to_a.first ? @geotweets.results.to_a.first.id : 0 %>";
  return currentId != newId;
}

var total = <%= @geotweets.results.total %>;
while(total > 0 && $('#geotweet-list').children().length >= 250 && newItem()) {
  var item = $('.list-group-item').last();
  console.log("item: " + item.text());
  markers[item.attr('id')].setMap(null);
  item.remove();
}

<% @geotweets.results.to_a.reverse.each do |geotweet| %>
  if ($("#<%= geotweet.id %>").length == 0 && $('#geotweet-list').children().length < 250) {
    $('#geotweet-list').prepend("<%= escape_javascript render(:partial => 'list_item', :locals => { geotweet: geotweet }) %>");

    var latitude = parseFloat(<%= geotweet.latitude %>);
    var longitude = parseFloat(<%= geotweet.longitude %>);
    var latLng = new google.maps.LatLng({lat: latitude, lng: longitude});

    var marker = new google.maps.Marker({
      icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
      map: window.map,
      position: latLng,
      title: "<%= geotweet.status %>"
    });

    window.markers["<%= geotweet.id %>"] = marker;

    $('li#<%= geotweet.id %>').mouseover(function () {
      markers["<%= geotweet.id %>"].setIcon('http://maps.google.com/mapfiles/ms/icons/green-dot.png');
    });

    $('li#<%= geotweet.id %>').mouseout(function () {
      markers["<%= geotweet.id %>"].setIcon('http://maps.google.com/mapfiles/ms/icons/red-dot.png');
    });
  }
<% end %>
